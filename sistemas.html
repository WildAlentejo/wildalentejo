<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistemas Off-Grid - Wild Alentejo</title>
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* CSS adicional para garantir que os dados apare√ßam bem */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background-color: #f7f7f0;
            border-radius: 8px;
        }
        .data-item h3 {
            margin-top: 0;
            color: #2D4C2F;
            font-size: 1.2em;
        }
        .data-value {
            font-size: 2.2em;
            color: #8DAF57;
            font-weight: 700;
            display: block;
            margin-top: 5px;
        }
        /* Estilo para tornar o iframe do YouTube responsivo */
        .video-container {
            position: relative; 
            padding-bottom: 56.25%; /* Rela√ß√£o de aspeto 16:9 */
            height: 0; 
            overflow: hidden; 
            max-width: 100%;
            margin-top: 20px;
        }
        .video-container iframe {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <img src="img/logo.png" alt="Wild Alentejo Logo">
            </div>
            <nav>
                <a href="index.html">In√≠cio</a> | 
                <a href="sistemas.html">Sistemas Off-Grid</a> | 
                <a href="agrofloresta.html">Agrofloresta</a> | 
                <a href="blog.html">Blog</a> | 
                <a href="loja.html">Loja</a> | 
                <a href="sobre.html">Sobre & Contacto</a>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <h2 style="font-weight: 700;">Sistemas Essenciais Off-Grid</h2>
            <p>Documenta√ß√£o detalhada e separada das infraestruturas cr√≠ticas de suporte √† vida e ao projeto no contexto de M√©rtola. Foco em medi√ß√µes e resultados.</p>

            <section id="monitorizacao-video" style="margin-top: 50px;">
                <h2>üé• Visualiza√ß√£o em Direto</h2>
                <p>Acompanhe o estado das instala√ß√µes solares e o clima no Alentejo atrav√©s do nosso feed em direto.</p>

                <div class="video-container">
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/xDiV4vPwbU?autoplay=1&mute=1&loop=1&playlist=xDiV4vPwbU" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowfullscreen
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                    ></iframe>
                </div>
            </section>


            <section id="dados-sensores" style="margin-top: 50px;">
                <h2>üìä Dados de Monitoriza√ß√£o em Tempo Real</h2>
                <p>M√©tricas vitais recolhidas do Home Assistant. √öltima atualiza√ß√£o: <strong id="last_updated">A carregar...</strong></p>
                
                <div class="data-grid">
                    <div class="data-item">
                        <h3>Tens√£o da Bateria</h3>
                        <span id="display_voltage" class="data-value">--</span><small> V</small>
                    </div>
                    <div class="data-item">
                        <h3>N√≠vel de Carga (SOC)</h3>
                        <span id="display_soc" class="data-value">--</span><small> %</small>
                    </div>
                    <div class="data-item">
                        <h3>N√≠vel da √Ågua do Po√ßo</h3>
                        <span id="display_water" class="data-value">--</span><small> %</small>
                    </div>
                    <div class="data-item">
                        <h3>Temperatura Estufa</h3>
                        <span id="display_temp" class="data-value">--</span><small> ¬∞C</small>
                    </div>
                </div>
            </section>
            
            <hr style="margin-top: 40px; margin-bottom: 40px;">
            
            <section class="sistema-card" style="margin-top: 30px; border: 1px solid #ddd; padding: 20px; background-color: white;">
                <h3>‚ö° Energia e Autonomia</h3>
                <p>Componentes instalados (1000W Solar, 360Ah Baterias) e an√°lise da performance.</p>
                <ul style="list-style-type: disc; padding-left: 20px;">
                    <li>Pot√™ncia instalada: **1000 W**</li>
                    <li>Capacidade total: **4.32 kWh nominal** (360 Ah @ 12V)</li>
                </ul>
                <p style="margin-top: 15px;"><a href="energia.html" class="btn-principal" style="background-color: #8DAF57;">&#8594; Ficha T√©cnica Completa</a></p>
            </section>
            
            <section class="sistema-card" style="margin-top: 30px; border: 1px solid #ddd; padding: 20px; background-color: white;">
                <h3>üíß Gest√£o H√≠drica e Resili√™ncia</h3>
                <p>Monitoriza√ß√£o do po√ßo e estrat√©gias passivas de conserva√ß√£o.</p>
                <ul style="list-style-type: disc; padding-left: 20px;">
                    <li>Fonte: **Po√ßo pr√≥prio**</li>
                    <li>Desafio cr√≠tico: **N√≠vel baixo no Ver√£o**</li>
                </ul>
                <p style="margin-top: 15px;"><a href="agua.html" class="btn-principal" style="background-color: #8DAF57;">&#8594; Dados de N√≠vel e Estrat√©gias</a></p>
            </section>
            
            <section class="sistema-card" style="margin-top: 30px; border: 1px solid #ddd; padding: 20px; background-color: white;">
                <h3>üí© Sanit√°rio e Ciclo de Nutrientes</h3>
                <p>Sistema de sanita seca e protocolo de reutiliza√ß√£o de nutrientes (urina e compostagem).</p>
                <ul style="list-style-type: disc; padding-left: 20px;">
                    <li>Sanita: **Seca (Compostagem)**</li>
                    <li>Fertiliza√ß√£o: **Urina dilu√≠da** (M√©todo sustent√°vel)</li>
                </ul>
                <p style="margin-top: 15px;"><a href="sanitario.html" class="btn-principal" style="background-color: #8DAF57;">&#8594; Protocolo de Aplica√ß√£o</a></p>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>
                &copy; 2025 Wild Alentejo. | 
                <a href="privacidade.html" style="color: inherit;">Pol√≠tica de Privacidade</a>
            </p>
        </div>
    </footer>

    <script>
        // ‚ö†Ô∏è ATEN√á√ÉO: SUBSTITUA COM OS SEUS DADOS REAIS ‚ö†Ô∏è
        const GIST_ID = '9b75822726a8c2ae2b8d372503a8c38a'; 
        const GITHUB_USERNAME = 'WildAlentejo'; // O SEU NOME DE UTILIZADOR NO GITHUB
        const GIST_URL_RAW = `https://gist.githubusercontent.com/${GITHUB_USERNAME}/${GIST_ID}/raw/wild-alentejo-sensors.json`;

        function fetchSensorData() {
            fetch(GIST_URL_RAW)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // O HA envia o JSON como uma string dentro do campo 'content'. Temos de a analisar:
                    const sensorData = JSON.parse(data.content); 
                    
                    // ‚ö†Ô∏è Mapeamento dos campos JSON para os elementos HTML ‚ö†Ô∏è
                    
                    // Dados de Energia
                    document.getElementById('display_voltage').textContent = sensorData.battery_voltage ? sensorData.battery_voltage.toFixed(2) : '--';
                    document.getElementById('display_soc').textContent = sensorData.battery_soc ? sensorData.battery_soc.toFixed(0) : '--';

                    // Dados de √Ågua/Estufa
                    document.getElementById('display_water').textContent = sensorData.well_water_level ? sensorData.well_water_level.toFixed(0) : '--';
                    document.getElementById('display_temp').textContent = sensorData.greenhouse_temp_c ? sensorData.greenhouse_temp_c.toFixed(1) : '--';
                    
                    // √öltima Atualiza√ß√£o
                    document.getElementById('last_updated').textContent = sensorData.last_updated;
                })
                .catch(error => {
                    console.error('Falha ao carregar dados dos sensores (Gist):', error);
                    document.getElementById('last_updated').textContent = 'Erro ao carregar dados.';
                });
        }

        // Carregar dados imediatamente
        fetchSensorData();
        // Opcional: Atualizar a cada 5 minutos (300000 ms)
        setInterval(fetchSensorData, 300000); 
    </script>
</body>
</html>